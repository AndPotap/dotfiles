#!/usr/bin/env bash

unset XDG_RUNTIME_DIR
if [[ ! -z \"${SLURM_JOBTMP}\" ]]; then
  export XDG_RUNTIME_DIR=\"${SLURM_JOBTMP}\"
fi

EXT3_NAME=${EXT3_NAME:-$(basename $(pwd))}
OVERLAY_ARGS="--overlay $OVERLAYFS"
BINDING_ARGS=""
if [[ ${#BINDING} -gt 1 ]]; then BINDING_ARGS="--bind $BINDING"; fi
if [[ -e /dev/nvidia0 ]]; then NV_ARGS="--nv"; fi

args=''
for i in "$@"; do 
  i="${i//\\/\\\\}"
  args="$args \"${i//\"/\\\"}\""
done

singularity exec ${BINDING_ARGS} ${NV_ARGS} ${OVERLAY_ARGS} ${SIF} \
  /bin/bash -l -c "${args}"
